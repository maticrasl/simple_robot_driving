<launch>

    <arg name="mapfile" default="optimization/Maze" />
    <arg name="kitti_path" default="/home/matic/Documents/Magistrska/Benchmarking" />
    <arg name="rosbag_path" default="/home/matic/Documents/Magistrska/bagfiles/recordings" />
    <arg name="initial_pos_x" default="1.25" />
    <arg name="initial_pos_y" default="-1.25" />
    <arg name="initial_pos_a" default="0.0" />
    <arg name="generate_gt" default="0" />

    <!-- LAMA PARAMS -->
    <arg name="d_thresh" default="0.01" />
    <arg name="a_thresh" default="0.25" />
    <arg name="l2_max" default="0.5" />
    <arg name="patch_size" default="32" />
    <arg name="max_iterations" default="100" />
    
    <!-- LAMA PF PARAMS -->
    <arg name="particles" default="30" />
    <arg name="threads" default="0" />
    <arg name="sigma" default="0.05" />
    <arg name="lgain" default="3" />
    <arg name="srr" default="0.01" />
    <arg name="str" default="0.02" />
    <arg name="stt" default="0.01" />
    <arg name="srt" default="0.01" />

    <!-- Parameters -->
    <param name="initial_pos_x" value="$(arg initial_pos_x)" />
    <param name="initial_pos_y" value="$(arg initial_pos_y)" />
    <param name="initial_pos_a" value="$(arg initial_pos_a)" />
    <param name="/use_sim_time" value="true" />


    <node pkg="tf2_ros" type="static_transform_publisher" name="static_transform_publisher" output="log" args="0 0 0 0 0 0 base_link laser_frame"/>

    <node pkg="tf" type="tf_remap" name="tf_remapper" output="screen">
        <rosparam param="mappings">
            [{old: odom, new: odom_old},{old: base_link, new: base_link_old},{old: laser_frame, new: laser_frame_old}]
        </rosparam>
    </node>
    
    <!-- LAMA PF -->
    <node pkg="iris_lama_ros" type="pf_slam2d_ros" name="pf_slam2d_ros" required="true" respawn="false" output="screen">
        <rosparam command="load" file="$(find simple_robot_driving)/config/slam/lama_pf_params.yaml" />
        <param name="global_frame_id" value="world" />
        <param name="rosbag" value="$(arg rosbag_path)/$(arg mapfile).bag" />
        <param name="initial_pos_x" value="$(arg initial_pos_x)" />
        <param name="initial_pos_y" value="$(arg initial_pos_y)" />
        <param name="initial_pos_a" value="$(arg initial_pos_a)" />
        <param name="d_thresh" value="$(arg d_thresh)" />
        <param name="a_thresh" value="$(arg a_thresh)" />
        <param name="l2_max" value="$(arg l2_max)" />
        <param name="patch_size" value="$(arg patch_size)" />
        <param name="max_iterations" value="$(arg max_iterations)" />
        <param name="particles" value="$(arg particles)" />
        <param name="threads" value="$(arg threads)" />
        <param name="sigma" value="$(arg sigma)" />
        <param name="lgain" value="$(arg lgain)" />
        <param name="srr" value="$(arg srr)" />
        <param name="str" value="$(arg str)" />
        <param name="stt" value="$(arg stt)" />
        <param name="srt" value="$(arg srt)" />
    </node>

    <!-- Benchmarker -->
    <node pkg="simple_robot_simulator" type="benchmarker.py" name="benchmarker" output="screen">
        <param name="kitti_path" value="$(arg kitti_path)" />
        <param name="mapfile" value="$(arg mapfile)" />
        <param name="generate_gt" value="$(arg generate_gt)" />
    </node>

    <!-- Rviz -->
    <!--<node type="rviz" name="rviz" pkg="rviz" args="-d $(find simple_robot_driving)/rviz/benchmark_configuration.rviz" output="log"/>-->

</launch>