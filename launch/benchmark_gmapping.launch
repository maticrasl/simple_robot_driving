<launch>

    <arg name="mapfile" default="optimization/Maze" />
    <arg name="kitti_path" default="/home/matic/Documents/Magistrska/Benchmarking" />
    <arg name="rosbag_path" default="/home/matic/Documents/Magistrska/bagfiles/recordings" />
    <arg name="rosbag_rate" default="25" />
    <arg name="node_start_delay" default="0.2" />
    <arg name="initial_pos_x" default="1.25" />
    <arg name="initial_pos_y" default="-1.25" />
    <arg name="initial_pos_a" default="0.0" />
    <arg name="generate_gt" default="0" />

    <!-- GMAPPING PARAMS -->
    <!-- Args for optimization -->
    <arg name="sigma" default="0.05" />
    <arg name="kernelSize" default="1" />
    <arg name="lstep" default="0.05" />
    <arg name="astep" default="0.05" />
    <arg name="lsigma" default="0.075" />
    <arg name="ogain" default="3.0" />
    <arg name="minimumScore" default="0.0" />
    <arg name="srr" default="0.002" />
    <arg name="srt" default="0.002" />
    <arg name="str" default="0.002" />
    <arg name="stt" default="0.005" />
    <arg name="resampleThreshold" default="0.5" />

    <!-- Fixed values args -->
    <arg name="particles" default="5" />
    <arg name="map_update_interval" default="2.0" />
    <arg name="iterations" default="5" />
    <arg name="linearUpdate" default="0.2" />
    <arg name="angularUpdate" default="0.5" />
    <arg name="llsamplerange" default="0.01" />
    <arg name="llsamplestep" default="0.01" />
    <arg name="lasamplerange" default="0.005" />
    <arg name="lasamplestep" default="0.005" />
    <arg name="transform_publish_period" default="0.05" />
    <arg name="occ_thresh" default="0.25" />

    <!-- Parameters -->
    <param name="initial_pos_x" value="$(arg initial_pos_x)" />
    <param name="initial_pos_y" value="$(arg initial_pos_y)" />
    <param name="initial_pos_a" value="$(arg initial_pos_a)" />


    <node pkg="tf2_ros" type="static_transform_publisher" name="static_transform_publisher" output="log" args="0 0 0 0 0 0 base_link laser_frame"/>

    <node pkg="tf" type="tf_remap" name="tf_remapper" output="screen">
        <rosparam param="mappings">
            [{old: odom, new: odom_old},{old: base_link, new: base_link_old},{old: laser_frame, new: laser_frame_old}]
        </rosparam>
    </node>
    
    <!-- GMapping -->
    <node pkg="gmapping" type="slam_gmapping" name="gmapping" respawn="false" >
        <rosparam command="load" file="$(find simple_robot_driving)/config/slam/gmapping_params.yaml" />
        <param name="map_frame" value="world"/>
        <param name="sigma" value="$(arg sigma)" />
        <param name="kernelSize" value="$(arg kernelSize)" />
        <param name="lstep" value="$(arg lstep)" />
        <param name="astep" value="$(arg astep)" />
        <param name="lsigma" value="$(arg lsigma)" />
        <param name="ogain" value="$(arg ogain)" />
        <param name="minimumScore" value="$(arg minimumScore)" />
        <param name="srr" value="$(arg srr)" />
        <param name="srt" value="$(arg srt)" />
        <param name="str" value="$(arg str)" />
        <param name="stt" value="$(arg stt)" />
        <param name="resampleThreshold" value="$(arg resampleThreshold)" />
        <param name="particles" value="$(arg particles)" />
        <param name="map_update_interval" value="$(arg map_update_interval)" />
        <param name="iterations" value="$(arg iterations)" />
        <param name="linearUpdate" value="$(arg linearUpdate)" />
        <param name="angularUpdate" value="$(arg angularUpdate)" />
        <param name="llsamplerange" value="$(arg llsamplerange)" />
        <param name="llsamplestep" value="$(arg llsamplestep)" />
        <param name="lasamplerange" value="$(arg lasamplerange)" />
        <param name="lasamplestep" value="$(arg lasamplestep)" />
        <param name="transform_publish_period" value="$(arg transform_publish_period)" />
        <param name="occ_thresh" value="$(arg occ_thresh)" />
    </node>

    <!-- Benchmarker -->
    <node pkg="simple_robot_simulator" type="benchmarker.py" name="benchmarker" output="screen">
        <param name="kitti_path" value="$(arg kitti_path)" />
        <param name="mapfile" value="$(arg mapfile)" />
        <param name="generate_gt" value="$(arg generate_gt)" />
    </node>

    <!-- Rviz -->
    <!--<node type="rviz" name="rviz" pkg="rviz" args="-d $(find simple_robot_driving)/rviz/benchmark_configuration.rviz" output="log"/>-->

    <!-- Rosbag -->
    <node pkg="rosbag" type="play" name="rosbag" args="--clock -r $(arg rosbag_rate) $(arg rosbag_path)/$(arg mapfile).bag --topics /tf /scan /ground_truth" required="true" launch-prefix="bash -c 'sleep $(arg node_start_delay); $0 $@' ">
        <remap from="tf" to="tf_old" />
    </node>

</launch>